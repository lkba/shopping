<!DOCTYPE html>
<html xmlns:v-on="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8"/>

    <link rel="stylesheet" href="../../t_css/el-index.css">
<!--    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">-->
    <link rel="stylesheet" href="../../plugins/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../t_css/style.css">

    <link rel="stylesheet" href="../../t_css/bootstrap.min.css"/>
    <link rel="stylesheet" href="../../t_css/layout.css"/>
    <link rel="stylesheet" type="text/css" href="../../t_css/student.css"/>
    <script src="../../t_js/jquery.js"></script>
    <script src="../../t_js/layer.js"></script>
    <script type="text/javascript" src="../../t_js/jquery.min.js"></script>
    <script type="text/javascript" src="../../t_js/bootstrap.min.js"></script>


    <title></title>
    <style>
        .header {
            margin-bottom: 50px;
        }

        .dec {
            margin-top: 20px;
            margin-bottom: 50px;
        }

        .dec span {
            margin-right: 20px;
            font-size: 18px;
        }

        .rightNav {
            margin-left: 100px;
            float: left;
            margin-top: 190px;
            width: 400px;
            font-size: 20px;
        }

        .rightNav ul li {
            list-style-type: none;
            margin: 20px auto;
            text-decoration: underline

        }

        .rightNav ul li a:active {
            text-decoration: none;

        }
        /*.el-upload__input{*/
        /*    display: none;*/
        /*}*/
        input[type=file] {
            display: none;
        }
.upload-demo{
    float: right;
}
    </style>
</head>
<body>
<div class="header"><span>团队云孵综合平台</span>
    <button type="button" class="btn btn-info" style="float: right;margin-right: 50px;margin-top: 20px;"
            onclick="back()">返回
    </button>
</div>
<div id="app" style="margin: 0 auto;min-width: 2000px">
    <div class="bodyer" style="float:left;margin-left: 10%;margin-top: 20px;">
        <center><h1 style="color: #0063a1;margin-top: 0px" class="center">{{pojo.title}}</h1></center>

        <center>
            <div class="clear dec">
                <span>举办方：{{pojo.hostMain}}</span>
                <span>开始时间：{{pojo.hostTime}}</span>
                <span>报名通道：
					<span v-if="pojo.statuss ==='yes'">
						<b style="color: red;">已开启报名</b>
						<span>参与报名：
							<span v-if="matchActor!=null" style="color: red;">已报名
                            </span></span>

							<span v-if="matchActor==null"><a href="javascript:;"
                                                             v-on:click="join()">尚未报名</a></span>
						</span>

					<span v-else>
						<b style="color: red;">已关闭报名</b>
						<span>参与报名：
							<span v-if="matchActor!=null" style="color: red;">
                                已报名

                            </span>

							<span v-if="matchActor==null"><a href="javascript:;">尚未报名</a></span>
						</span>
					</span>
				</span>
                <span style="float: right;margin-right: 160px" v-if="matchActor!=null">文件上传：
<!--                    <b style="float: left">文件上传：</b>-->
                        <el-upload
                                class="upload-demo"
                                action="/upload/oss.do"
                                :on-preview="handlePreview"
                                :on-remove="handleRemove"
                                :before-remove="beforeRemove"
                                :on-success="handleAvatarSuccess"
                                :limit="1"
                                :on-exceed="handleExceed"
                                :file-list="fileList">
                          <el-div size="small" type="primary">点击上传</el-div>
<!--                          <div slot="tip" class="el-upload__tip">只能上传jpg/png文件，且不超过500kb</div>-->
                        </el-upload>
                    <span style="color: red" v-if="matchActor.mfile!=null">
                        文件已上传
                    </span>
                </span>

            </div>
        </center>
        <div class="contents mr ml" id="content1">
            <div v-html="pojo.content">{{pojo.content}}</div>
        </div>
        <form method="post">
            <input type="hidden" name="id" value="{$match.id}"/>
            <button type="button" class="btn btn-info" style="float: left;margin-left: 20px;margin-bottom: 100px;"
                    onclick="back()">返回
            </button>

            <span v-if="pojo.statuss =='yes'">
                <span v-if="matchActor==null">
					<span type="button" class="btn btn-info" style="float: left;margin-left: 20px;"
                            v-on:click="join()">报名

            </button>
                        </span>
			</span>

        </form>
    </div>
    <div class="rightNav">
        <center><h2 style="color: #0063a1;margin-top: 10px;text-decoration: underline" class="">最新赛事</h2></center>
        <ul>
            <li v-for="rN in rightNav"><a :href="'show.html?id='+rN.id+'&tid='+tid">{{rN.title}}</a></li>

        </ul>
    </div>
</div>
<div class="footer text-center">
    <span>技术支持：阔鱼飞鸟云孵平台</span>
    <span> &nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp; 联系方式：xxxxxxxxxx</span>
</div>
</body>
</html>
<script src="../../t_js/vue.js"></script>
<script src="../../t_js/axios.js"></script>
<script src="../../t_js/util.js"></script>
<script src="../../t_js/elementui.js"></script>
<script>
    new Vue({
        el: '#app',
        data() {
            return {
                tableData: [],
                rightNav: [],
                fileList:[],
                matchActor: {},
                matchActorUp: {},
                currentPage: 1,
                total: 10,
                size: 10,
                searchMap: {},
                pojo: {},
                tid: null,
                formVisible: false,
                imageUrl: '',
                imageUrls: '',
                id: '',
            }
        },
        created() {
            this.fetchData();
        },
        methods: {
            fetchData() {
                this.pojo.id = getQueryString("id");
                this.tid = getQueryString("tid");
                // console.log(this.pojo.id)
                axios.get(`/match/findById.do?id=${this.pojo.id}`).then(response => {
                    this.pojo = response.data;
                })
                this.searchMap.mid = this.pojo.id;
                this.searchMap.tid = this.tid;
                // console.log(this.searchMap)
                axios.post(`/matchActor/findList.do`, this.searchMap).then(response => {
                    this.matchActor = response.data[0];
                    if (this.matchActor.mfile!=""){
                        this.fileList[0]= {name: '已上传',url:this.matchActor.mfile};
                        // this.fileList[0].name= '已上传';
                        // this.fileList[0].url= this.matchActor.mfile;
                            // {name: '已上传',url:this.matchActor.mfile};
                    }
                    // this.fileList[0]=
                    // console.log(this.matchActor.mfile)
                    // console.log(this.fileList)
                })
                axios.get(`/match/findAll.do`).then(response => {
                    this.rightNav = response.data;
                    // console.log(this.rightNav)
                })
            },
            join() {
                layer.confirm('确认要参与报名吗？', {icon: 3, title: "是否报名？"}, function (index) {

                    if (this.matchActor == null) {
                        this.matchActorUp = {"tid": getQueryString("tid")};
                        // this.matchActorUp.tid=getQueryString("tid");
                        // console.log(this.matchActor)
                        axios.post(`/basicInfor/findList.do`, this.matchActorUp).then(response => {
                            // console.log(response.data[0])
                            // // this.matchActor.team= response.data[0].team;
                            this.matchActorUp = {
                                "tname": response.data[0].team,
                                "tid": getQueryString("tid"),
                                "mid": getQueryString("id")
                            };
                            // // this.matchActorUp.team=response.data[0].team;
                            // this.matchActorUp= {"mid":getQueryString("id")};
                            // // this.matchActorUp.mid= getQueryString("id");
                            // console.log(this.matchActorUp)
                            axios.post(`/matchActor/add.do`, this.matchActorUp).then(response => {
                                parent.location.reload();
                            })
                        })

                    }
                });
            },
            save() {
                // this.pojo.image = this.imageUrl; //如页面有图片上传功能放开注释
                // this.pojo.images = this.imageUrls; //如页面有图片上传功能放开注释
                axios.post(`/sku/${this.pojo.id == null ? 'add' : 'update'}.do`, this.pojo).then(response => {
                    this.fetchData(); //刷新列表
                    this.formVisible = false;//关闭窗口
                });
            },
            edit(id) {
                this.formVisible = true // 打开窗口
                // 调用查询
                axios.get(`/sku/findById.do?id=${id}`).then(response => {
                    this.pojo = response.data;
                    // this.imageUrl=this.pojo.image //显示图片  如页面有图片上传功能放开注释
                })
            },
            dele(id) {
                this.$confirm('确定要删除此记录吗?', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(() => {
                    axios.get(`/sku/delete.do?id=${id}`).then(response => {
                        this.fetchData(); //刷新列表
                    })
                })
            },
            handleRemove(file, fileList) {
                this.matchActor.mfile="";
                axios.post(`/matchActor/update.do`,this.matchActor).then(response => {
                    this.fetchData(); //刷新列表
                    // this.formVisible = false;//关闭窗口
                });
                // console.log(file, fileList);
            },
            handlePreview(file) {
                console.log(file);
            },
            handleExceed(files, fileList) {
                this.$message.warning(`当前限制选择 1 个文件，本次选择了 ${files.length} 个文件，共选择了 ${files.length + fileList.length} 个文件`);
            },
            beforeRemove(file, fileList) {
                return this.$confirm(`确定移除 ${ file.name }？`);
            },
            /* ****图片上传相关代码  如页面有图片上传功能放开注释 *****/
            handleAvatarSuccess(res, file) {
                this.imageUrl = file.response;
                this.matchActor.mfile=file.response;
                axios.post(`/matchActor/update.do`,this.matchActor).then(response => {
                    this.fetchData(); //刷新列表
                    // this.formVisible = false;//关闭窗口
                });

                console.log(this.fileList)
                // console.log( this.imageUrl)
                // console.log( this.matchActor)
            },
            handleAvatarSuccess2(res, file) {
                this.imageUrls = file.response;
            },
            beforeAvatarUpload(file) {
                const isLt2M = file.size / 1024 / 1024 < 10;
                if (!isLt2M) {
                    this.$message.error('上传文件大小不能超过 10MB!');
                }
                return isLt2M;
            }
        }
    })
</script>
<script>
    function back() {
        window.location.href = "index.html";
    }

    $(document).ready(function () {
        // $('#content1').html($.trim(text0));
        function back() {
            window.location.href = "index.html";
        }
    });
</script>

<script>
    // function join(obj, id, name) {
    //     layer.confirm('确认要参与报名吗？', {icon: 3, title: "是否报名？"}, function (index) {
    //         $.get("__CONTROLLER__/join", {mid: id}, function (msg) {
    //             if (msg.flag === true) {
    //                 layer.msg('报名成功!', {icon: 1, time: 1000, title: "确认"});
    //                 setTimeout(location.reload(), 2000);
    //             } else {
    //                 alert(msg.msg);
    //             }
    //         }, "json");
    //     });
    // }
</script>

